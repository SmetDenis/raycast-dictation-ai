# Dictation AI

Мощное расширение Raycast для преобразования речи в текст с использованием OpenAI Whisper и форматирования с помощью моделей OpenRouter. Идеально подходит для быстрой диктовки, заметок и профессионального общения.

> **Примечание**: Этот проект является форком [Advanced Speech to Text](https://www.raycast.com/inakitajes/advanced-speech-to-text) от Iñaki Tajes. Особая благодарность Iñaki за создание оригинального расширения, которое послужило основой для этой улучшенной версии.

## Возможности

- **Мгновенная запись**: Автоматически начинает запись при открытии
- **Высококачественная транскрипция**: Использует модели GPT-4o Transcribe и Whisper от OpenAI
- **Умное форматирование текста**: Форматирование транскрипций для различных контекстов с помощью моделей OpenRouter
- **Множественные форматы вывода**: Оригинальный, Email, Slack, Отчет и режим перевода
- **История записей**: Просмотр и управление прошлыми записями с транскрипциями
- **Кастомные промпты**: Использование пользовательских файлов промптов для контекста транскрипции и форматирования
- **Автовставка**: Автоматически вставляет отформатированный текст в активное поле
- **Многоязычная поддержка**: Поддерживает 10+ языков с автоопределением

## Установка

1. Установите расширение из [Raycast Store](https://www.raycast.com/extensions)
2. Установите SoX (Sound eXchange) для записи аудио:
   ```bash
   # Используя Homebrew
   brew install sox
   
   # Используя MacPorts
   sudo port install sox
   ```
3. Настройте ваши API ключи в настройках Raycast

## Настройка

### Необходимые API ключи

1. **OpenAI API Key**: Для транскрипции речи
   - Получите ключ на [OpenAI Platform](https://platform.openai.com/api-keys)
   - Требуется для транскрипции Whisper

2. **OpenRouter API Key**: Для форматирования текста
   - Получите ключ на [OpenRouter](https://openrouter.ai/keys)
   - Требуется для режимов форматирования (Email, Slack, Отчет, Перевод)

### Системные требования

- **SoX**: Необходим для записи аудио
- **macOS**: Платформа расширений Raycast
- **Микрофон**: Для аудио ввода

## Использование

### Базовая диктовка

1. Откройте Raycast и введите "Dictate"
2. Запись начинается автоматически
3. Произнесите ваше сообщение
4. Нажмите Enter для остановки и транскрипции
5. Текст автоматически вставляется в активное поле

### Режимы форматирования

Во время записи вы можете выбрать различные форматы вывода:

- **Оригинальный**: Необработанная транскрипция с автовставкой
- **Email**: Профессиональный формат email с приветствиями и структурой
- **Slack**: Чистое, неформальное форматирование сообщений
- **Отчет**: Структурированный формат отчетности по задачам/проектам
- **Перевод**: Перевод на английский или улучшение английского текста

### История записей

- Доступ через команду "Recording History"
- Просмотр прошлых записей с метаданными
- Повторная транскрипция аудиофайлов
- Копирование транскрипций в буфер обмена

## Конфигурация

### Настройки транскрипции

- **Модель**: Выбор между GPT-4o Transcribe (новейшая) или Whisper-1 (классическая)
- **Язык**: Автоопределение или указание языка (английский, испанский, французский и т.д.)
- **Температура**: Контроль креативности транскрипции (0-1)
- **Файл контекста**: Пользовательский файл промпта для улучшения точности для специфических терминов

### Настройки форматирования

- **Модель OpenRouter**: По умолчанию `google/gemini-2.5-flash`
- **Кастомные промпты**: Переопределение стандартных промптов форматирования пользовательскими файлами

### Кастомные промпты

Вы можете предоставить пользовательские файлы промптов для лучшей точности транскрипции и форматирования:

#### Файл контекста транскрипции
Улучшает распознавание речи для специфических имен, терминов или сокращений:

```
## Prompt
```xml
Контекст для распознавания речи:
- Компания: ООО "Рога и Копыта"
- Имена: Иван Петров, Анна Сидорова
- Технические термины: Kubernetes, PostgreSQL
- Сокращения: API, CI/CD, SLA
```

#### Кастомные промпты форматирования
Переопределение стандартного форматирования пользовательскими промптами:

```
## Prompt
```markdown
Преобразуйте следующий текст в неформальное командное обновление по email.
Сохраните дружелюбный и разговорный тон, сосредоточившись на прогрессе и следующих шагах.
```

## Техническая архитектура

### Основные компоненты

- **Команда Dictate** (`src/dictate.tsx`): Основной рабочий процесс записи и транскрипции
- **История записей** (`src/recording-history.tsx`): Интерфейс управления историей
- **Хук аудио записи** (`src/hooks/useAudioRecorder.ts`): Интеграция SoX для записи

### Аудио система

- Использует SoX (Sound eXchange) для кроссплатформенной записи
- Записывает в формате WAV (16kHz, mono, 16-bit) оптимизированном для Whisper
- Автоматическое обнаружение SoX по общим путям установки
- Валидация аудио и управление временными файлами

### API интеграция

- **OpenAI**: Транскрипция через модели Whisper и GPT-4o
- **OpenRouter**: Форматирование текста с различными LLM провайдерами
- Надежная обработка ошибок для лимитов API и аутентификации

### Управление файлами

- Временные аудиофайлы хранятся в `~/Library/Application Support/com.raycast.macos/extensions/dictation-ai/temp`
- Автоматическая очистка файлов старше 24 часов
- Нет постоянного хранения данных кроме временных аудиофайлов

## Разработка

### Команды

```bash
npm run dev          # Запуск режима разработки
npm run build        # Сборка расширения
npm run lint         # Запуск ESLint
npm run fix-lint     # Исправление проблем линтинга
npm run publish      # Публикация в Raycast Store
```

### Структура проекта

```
src/
├── dictate.tsx              # Основная команда диктовки
├── recording-history.tsx    # Управление историей
├── hooks/
│   └── useAudioRecorder.ts  # Логика записи аудио
├── utils/
│   ├── audio.ts            # Интеграция SoX и управление файлами
│   ├── openai.ts           # Интеграция OpenAI API
│   ├── formatters.ts       # Форматирование текста с OpenRouter
│   ├── clipboard.ts        # Операции буфера обмена
│   ├── errors.ts           # Обработка ошибок
│   └── time.ts             # Утилиты форматирования времени/размера
├── types.ts                # TypeScript определения
└── constants.ts            # Константы конфигурации
```

## Устранение неполадок

### Распространенные проблемы

**SoX не установлен**
```bash
# Установка через Homebrew
brew install sox
```

**Запись не работает**
- Проверьте разрешения микрофона в Системных настройках
- Убедитесь что SoX установлен и доступен
- Попробуйте различные источники ввода микрофона

**Ошибки API**
- Проверьте что у OpenAI API ключа достаточно кредитов
- Проверьте валидность OpenRouter API ключа
- Убедитесь что интернет соединение стабильно

**Ограничения размера файлов**
- Максимальный размер аудиофайла: 25MB (ограничение OpenAI)
- Минимальный размер аудио: 1KB
- Файлы автоматически валидируются перед транскрипцией

### Сообщения об ошибках

- `Sox is not installed`: Установите SoX используя Homebrew или MacPorts
- `Audio file exceeds 25MB limit`: Запись слишком длинная, попробуйте более короткие сессии
- `OpenAI API key is required`: Настройте API ключ в настройках
- `Transcription failed`: Проверьте API ключ и интернет соединение

## Приватность и безопасность

- Аудиофайлы временно хранятся локально и автоматически удаляются
- Нет постоянного хранения голосовых записей
- API ключи безопасно хранятся в настройках Raycast
- Все API вызовы используют HTTPS шифрование

## Лицензия

MIT License - см. файл LICENSE для деталей.

## Вклад в проект

1. Сделайте форк репозитория
2. Создайте ветку для функции
3. Внесите ваши изменения
4. Добавьте тесты если применимо
5. Отправьте pull request

## Поддержка

- [Сообщить о проблеме](https://github.com/smetdenis/raycast-dictation-ai/issues)
- [Сообщество Raycast](https://raycast.com/community)
- [Документация OpenAI](https://platform.openai.com/docs)
- [Документация OpenRouter](https://openrouter.ai/docs)