# Dictation AI

Мощное расширение Raycast для преобразования речи в текст и форматирования вывода с использованием продвинутых языковых моделей OpenAI. Идеально подходит для быстрой диктовки, заметок и профессионального общения с интеллектуальным форматированием текста.

> **Примечание**: Этот проект является форком [Advanced Speech to Text](https://www.raycast.com/inakitajes/advanced-speech-to-text) от Iñaki Tajes. Особая благодарность Iñaki за создание оригинального расширения, которое послужило основой для этой улучшенной версии.

## Возможности

- **Мгновенная запись**: Автоматически начинает запись при открытии
- **Высококачественная транскрипция**: Использует модели Whisper-1 и GPT-4o Transcribe от OpenAI
- **Умное форматирование текста**: Форматирование транскрипций с помощью языковых моделей OpenAI (GPT-4o, GPT-4o-mini)
- **Множественные форматы вывода**: Оригинальный, Email, Slack, Отчет, Список задач и режим перевода
- **Гибкое поведение вставки**: Четыре режима - только вставка, копирование и вставка, только копирование, или показ с кнопками действий
- **История записей**: Просмотр и управление прошлыми записями с транскрипциями
- **Кастомные промпты**: Использование пользовательских файлов промптов для контекста транскрипции и форматирования
- **Горячие клавиши**: Комплексные сочетания клавиш для эффективного рабочего процесса
- **Многоязычная поддержка**: Поддерживает 11 языков с автоопределением
- **OpenAI-совместимые API**: Настраиваемый базовый URL для альтернативных провайдеров

## Установка

1. Установите расширение из [Raycast Store](https://www.raycast.com/extensions)
2. Установите SoX (Sound eXchange) для записи аудио:
   ```bash
   # Используя Homebrew
   brew install sox

   # Используя MacPorts
   sudo port install sox
   ```
3. Настройте ваш OpenAI API ключ в настройках Raycast

## Настройка

### Необходимый API ключ

**OpenAI API Key**: Для транскрипции речи и форматирования текста
- Получите ключ на [OpenAI Platform](https://platform.openai.com/api-keys)
- Единый API ключ обрабатывает все операции (транскрипция и форматирование)

### Системные требования

- **SoX**: Необходим для записи аудио
- **macOS**: Платформа расширений Raycast
- **Микрофон**: Для аудио ввода

## Использование

### Базовая диктовка

1. Откройте Raycast и введите "Dictate"
2. Запись начинается автоматически
3. Произнесите ваше сообщение
4. Нажмите Enter для остановки и транскрипции
5. Поведение текста зависит от настройки предпочтений вставки

### Режимы форматирования

Во время записи вы можете выбрать различные форматы вывода с помощью горячих клавиш:

- **Оригинальный** (Enter): Необработанная транскрипция с настраиваемым поведением вставки
- **Email** (Cmd+E): Профессиональный формат email с приветствиями и структурой
- **Slack** (Cmd+S): Чистое, неформальное форматирование сообщений
- **Отчет** (Cmd+R): Структурированный формат отчетности по задачам/проектам
- **Задачи** (Cmd+T): Структурированный список задач с чекбоксами и элементами действий
- **Перевод** (Cmd+L): Перевод на английский или улучшение английского текста

### Варианты поведения вставки

Настройте как обрабатывается текст после транскрипции:

- **Только вставка**: Прямая вставка в активное поле (без копирования в буфер)
- **Копирование и вставка**: Копирование в буфер, затем вставка в активное поле
- **Только копирование**: Копирование в буфер без автоматической вставки
- **Показ с кнопками действий**: Отображение результата с ручным выбором действий

### Горячие клавиши

**Во время записи:**
- `Enter` - Остановить и транскрибировать с оригинальным форматом
- `Cmd+E` - Остановить и отформатировать как Email
- `Cmd+S` - Остановить и отформатировать для Slack
- `Cmd+T` - Остановить и отформатировать как список задач
- `Cmd+R` - Остановить и отформатировать как отчет
- `Cmd+L` - Остановить и перевести на английский
- `Cmd+.` - Отменить запись

**В режиме результатов:**
- `Enter` - Вставить в выбранное поле (основное действие)
- `Cmd+C` - Копировать в буфер
- `Cmd+V` - Копировать и вставить
- `Cmd+Shift+V` - Только вставить
- `Cmd+Shift+C` - Только копировать
- `Cmd+E` - Отформатировать как Email
- `Cmd+S` - Отформатировать для Slack
- `Cmd+T` - Отформатировать как список задач
- `Cmd+R` - Отформатировать как отчет
- `Cmd+L` - Перевести на английский
- `Cmd+O` - Использовать оригинальную транскрипцию
- `Cmd+N` - Новая запись

### История записей

- Доступ через команду "Recording History"
- Просмотр прошлых записей с метаданными (длительность, размер, количество слов)
- Повторная транскрипция аудиофайлов с текущими настройками
- Копирование транскрипций в буфер обмена
- Автоматическая очистка файлов через 24 часа

## Конфигурация

### Настройки транскрипции

- **Модель**: Текстовое поле для любой модели транскрипции OpenAI (по умолчанию: whisper-1)
  - Примеры: whisper-1, gpt-4o-transcribe
- **Язык**: Автоопределение или указание языка (английский, испанский, французский, немецкий, итальянский, португальский, китайский, японский, корейский, русский)
- **Температура**: Контроль креативности транскрипции (0, 0.2, 0.5, 0.8, 1.0)
- **Файл контекста**: Пользовательский файл промпта для улучшения точности для специфических терминов

### Настройки форматирования

- **Модель форматирования**: Текстовое поле для любой языковой модели OpenAI (по умолчанию: gpt-4o)
  - Примеры: gpt-4o, gpt-4o-mini, gpt-3.5-turbo
- **Базовый URL**: OpenAI-совместимая конечная точка API (по умолчанию: https://api.openai.com/v1)
- **Кастомные промпты**: Переопределение стандартных промптов форматирования пользовательскими файлами

### Поведение вставки

- **Поведение вставки**: Выберите как обрабатывается текст после обработки
  - Только вставка, Копирование и вставка, Только копирование, Показ с кнопками действий

### Кастомные промпты

Вы можете предоставить пользовательские файлы промптов для лучшей точности транскрипции и форматирования:

#### Файл контекста транскрипции
Улучшает распознавание речи для специфических имен, терминов или сокращений:

```
## Prompt
Контекст для распознавания речи:
- Компания: ООО "Рога и Копыта"
- Имена: Иван Петров, Анна Сидорова
- Технические термины: Kubernetes, PostgreSQL
- Сокращения: API, CI/CD, SLA
```

#### Кастомные промпты форматирования
Переопределение стандартного форматирования пользовательскими промптами:

```
## Prompt
Преобразуйте следующий текст в неформальное командное обновление по email.
Сохраните дружелюбный и разговорный тон, сосредоточившись на прогрессе и следующих шагах.
```

## Техническая архитектура

### Основные компоненты

- **Команда Dictate** (`src/dictate.tsx`): Основной рабочий процесс записи и транскрипции с управлением состоянием
- **История записей** (`src/recording-history.tsx`): Интерфейс управления историей
- **Хук аудио записи** (`src/hooks/useAudioRecorder.ts`): Интеграция SoX для записи

### Аудио система

- Использует SoX (Sound eXchange) для кроссплатформенной записи
- Записывает в формате WAV (16kHz, mono, 16-bit) оптимизированном для Whisper
- Автоматическое обнаружение SoX по общим путям установки: `/usr/local/bin/sox`, `/opt/homebrew/bin/sox`, `/usr/bin/sox`
- Валидация аудио (минимум 1KB, максимум 25MB) и управление временными файлами

### API интеграция

- **OpenAI**: Единый провайдер для транскрипции и форматирования текста
- Настраиваемый базовый URL поддерживает OpenAI-совместимые API
- Надежная обработка ошибок для лимитов API, аутентификации и проблем с квотой
- Настройка температуры влияет как на транскрипцию, так и на форматирование

### Управление файлами

- Временные аудиофайлы хранятся в `~/Library/Application Support/com.raycast.macos/extensions/dictation-ai/temp`
- Автоматическая очистка файлов старше 24 часов
- Нет постоянного хранения данных кроме временных аудиофайлов
- Валидация файлов и принудительное ограничение размера

### Операции с буфером обмена

Продвинутое управление буфером обмена с множественными режимами вставки:
- Прямая вставка с откатом к копированию
- Умная маршрутизация на основе пользовательских предпочтений
- HUD уведомления для обратной связи с пользователем
- Обработка ошибок с изящной деградацией

## Разработка

### Команды

```bash
npm run dev          # Запуск режима разработки Raycast
npm run build        # Сборка расширения
npm run lint         # Запуск ESLint
npm run fix-lint     # Автоматическое исправление проблем ESLint
npm run test         # Запуск Jest тестов
npm run test:watch   # Запуск Jest тестов в режиме наблюдения
npm run test:coverage # Запуск Jest тестов с отчетом покрытия
npm run publish      # Публикация в Raycast Store
```

### Структура проекта

```
src/
├── dictate.tsx              # Основная команда диктовки
├── recording-history.tsx    # Управление историей
├── hooks/
│   └── useAudioRecorder.ts  # Логика записи аудио
├── utils/
│   ├── audio.ts            # Интеграция SoX и управление файлами
│   ├── openai.ts           # Интеграция OpenAI API
│   ├── formatters.ts       # Форматирование текста с моделями OpenAI
│   ├── clipboard.ts        # Операции буфера обмена с поведениями вставки
│   ├── errors.ts           # Централизованная обработка ошибок
│   ├── prompts.ts          # Утилиты загрузки кастомных промптов
│   └── time.ts             # Утилиты форматирования времени/размера
├── types.ts                # TypeScript определения
└── constants.ts            # Константы конфигурации
```

## Устранение неполадок

### Распространенные проблемы

**SoX не установлен**
```bash
# Установка через Homebrew
brew install sox
```

**Запись не работает**
- Проверьте разрешения микрофона в Системных настройках
- Убедитесь что SoX установлен и доступен в PATH
- Попробуйте различные источники ввода микрофона
- Проверьте уровни аудио входа

**Ошибки API**
- Проверьте что у OpenAI API ключа достаточно кредитов
- Проверьте разрешения API ключа для аудио и чат конечных точек
- Убедитесь что интернет соединение стабильно
- Попробуйте другой базовый URL если используете альтернативного провайдера

**Ограничения размера файлов**
- Максимальный размер аудиофайла: 25MB (ограничение OpenAI)
- Минимальный размер аудио: 1KB для валидации
- Файлы автоматически валидируются перед транскрипцией
- Длинные записи могут достигать лимитов размера

**Проблемы с вставкой/буфером обмена**
- Проверьте разрешения приложения для доступа к буферу обмена
- Попробуйте различные настройки поведения вставки
- Убедитесь что целевое приложение принимает ввод из буфера обмена
- Используйте режим "Показ с кнопками действий" для ручного контроля

### Сообщения об ошибках

- `Sox is not installed`: Установите SoX используя Homebrew или MacPorts
- `Audio file exceeds 25MB limit`: Запись слишком длинная, попробуйте более короткие сессии
- `OpenAI API key is required`: Настройте API ключ в настройках
- `Transcription failed`: Проверьте API ключ, кредиты и интернет соединение
- `Audio file is too short`: Убедитесь в минимальном размере файла 1KB
- `Paste Error`: Целевое приложение может не принимать ввод из буфера обмена

## Приватность и безопасность

- Аудиофайлы временно хранятся локально и автоматически удаляются через 24 часа
- Нет постоянного хранения голосовых записей
- API ключи безопасно хранятся в настройках Raycast
- Все API вызовы используют HTTPS шифрование
- Нет телеметрии или отслеживания использования
- Локальная обработка с внешними API вызовами только для транскрипции/форматирования

## Лицензия

MIT License - см. файл LICENSE для деталей.

## Вклад в проект

1. Сделайте форк репозитория
2. Создайте ветку для функции
3. Внесите ваши изменения
4. Добавьте тесты если применимо
5. Обновите документацию по необходимости
6. Отправьте pull request

## Поддержка

- [Сообщить о проблеме](https://github.com/smetdenis/raycast-dictation-ai/issues)
- [Сообщество Raycast](https://raycast.com/community)
- [Документация OpenAI](https://platform.openai.com/docs)

## Журнал изменений

### Недавние обновления

- **Унифицированная интеграция OpenAI**: Удалена зависимость от OpenRouter, теперь используется только OpenAI для всех операций
- **Гибкая конфигурация моделей**: Текстовые поля для выбора кастомных моделей
- **Улучшенное поведение вставки**: Четыре различных режима включая "показ с действиями"
- **Комплексные горячие клавиши**: Полная поддержка сочетаний клавиш для эффективного рабочего процесса
- **OpenAI-совместимые API**: Настраиваемый базовый URL для альтернативных провайдеров
- **Улучшенная обработка ошибок**: Лучшие сообщения об ошибках и варианты восстановления